<?php

function path($section) {

    $env = ENV === 'Site' ? mb_strtolower(ENV) . '/' : '';

    $pathMask = ROOT_DIR . DS . $env . '%s';

    // Return path to correct section.
    switch (strtolower($section))
    {
        case 'controller':
            return sprintf($pathMask, 'Controller');
        case 'config':
            return sprintf($pathMask, 'Config');
        case 'model':
            return sprintf($pathMask, 'Model');
        case 'view':
            return sprintf($pathMask, 'View');
        case 'language':
            return sprintf($pathMask, 'Language');
        default:
            return ROOT_DIR;
    }
}

function languages() {
    $directory = path('language');
    $list      = scandir($directory);
    $languages = [];
    if (!empty($list)) {
        unset($list[0]);
        unset($list[1]);
        foreach ($list as $dir) {
            $pathLangDir = $directory . DS . $dir;
            $pathConfig  = $pathLangDir . '/config.json';
            if (is_dir($pathLangDir) and is_file($pathConfig)) {
                $config = file_get_contents($pathConfig);
                $info   = json_decode($config);
                $languages[] = $info;
            }
        }
    }
    return $languages;
}

function getTypes($switch = 'page') {
    $themePath = ROOT_DIR . '/../site/View' . DS . 'themes' . '/' . \Setting::get('active_theme');
    
    $list      = scandir($themePath);
    $types     = [];
    if (!empty($list)) {
        unset($list[0]);
        unset($list[1]);
        foreach ($list as $name) {
            if (\Core\Helper\Common::searchMatchString($name, $switch)) {
                list($switch, $key) = explode('-', $name, 2);
                if (!empty($key)) {
                    list($nameType) = explode('.', $key, 2);
                    $types[$nameType] = ucfirst($nameType);
                }
            }
        }
    }
    return $types;
}

function getThemes() {
    $themesPath = ROOT_DIR . '/../site/View' . DS . 'themes';
    $list       = scandir($themesPath);
    $baseUrl    = \Core\Worker\Config\Config::item('baseUrl');
    $themes     = [];

    if (!empty($list)) {
        unset($list[0]);
        unset($list[1]);
        foreach ($list as $dir) {
            $pathThemeDir = $themesPath . '/' . $dir;
            $pathConfig   = $pathThemeDir . '/theme.json';
            $pathScreen   = '/site/View/themes' . DS . $dir . '/screen.jpg';
            if (is_dir($pathThemeDir) && is_file($pathConfig)) {
                $config = file_get_contents($pathConfig);
                $info   = json_decode($config);
                $info->screen   = $pathScreen;
                $info->dirTheme = $dir;
                $themes[] = $info;
            }
        }
    }
    return $themes;
}

function getPlugins() {

    global $di;

    $pluginsPath = ROOT_DIR . '/../site/' . DS . 'Plugin';
    $list        = scandir($pluginsPath);
    $plugins     = [];

    if (!empty($list)) {
        unset($list[0]);
        unset($list[1]);

        foreach ($list as $namePlugin) {
            $namespace = '\\Site\\Plugin\\' . $namePlugin . '\\Plugin';
            if (class_exists($namespace)) {
                /** @var Engine\Plugin $plugin */
                $plugin = new $namespace($di);
                $plugins[$namePlugin] = $plugin->details();
            }
        }
    }

    return $plugins;
}

function getIcon($icon) {
    if ($icon == 'dog') {
        return '<?xml version="1.0" encoding="iso-8859-1"?>
        <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
             viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
        <g>
            <g>
                <path d="M372.256,200.691c-1.778-3.74-6.252-5.328-9.99-3.554c-3.74,1.777-5.331,6.25-3.553,9.99
                    c1.312,2.758,1.975,5.721,1.975,8.807v16.026c0,11.331-9.219,20.549-20.548,20.549c-11.331,0-20.549-9.219-20.549-20.549v-16.026
                    c0-11.331,9.219-20.549,20.549-20.549c4.14,0,7.497-3.357,7.497-7.497c0-4.14-3.357-7.497-7.497-7.497
                    c-19.599,0-35.544,15.945-35.544,35.544v16.026c0,19.599,15.945,35.544,35.544,35.544s35.543-15.945,35.543-35.544v-16.026
                    C375.683,210.605,374.529,205.477,372.256,200.691z"/>
            </g>
        </g>
        <g>
            <g>
                <path d="M203.979,200.691c-1.777-3.74-6.25-5.328-9.99-3.554c-3.74,1.777-5.331,6.25-3.553,9.99
                    c1.312,2.758,1.975,5.721,1.975,8.807v16.026c0,11.331-9.219,20.549-20.549,20.549s-20.548-9.219-20.548-20.549v-16.026
                    c0-11.331,9.219-20.549,20.548-20.549c4.141,0,7.497-3.357,7.497-7.497c0-4.14-3.357-7.497-7.497-7.497
                    c-19.599,0-35.543,15.945-35.543,35.544v16.026c0,19.599,15.944,35.544,35.543,35.544s35.544-15.945,35.544-35.544v-16.026
                    C207.405,210.605,206.252,205.477,203.979,200.691z"/>
            </g>
        </g>
        <g>
            <g>
                <path d="M511.74,146.251c-0.254-1.188-6.409-29.411-21.757-58.062c-21.044-39.285-49.307-60.049-81.732-60.049
                    c-24.426,0-55.284,14.774-59.081,16.639c-12.675,4.968-19.89,3.031-32.914-0.481c-12.744-3.437-30.199-8.144-60.256-8.144
                    s-47.511,4.707-60.256,8.144c-13.023,3.513-20.238,5.45-32.914,0.481c-3.797-1.864-34.655-16.639-59.081-16.639
                    c-32.424,0-60.687,20.764-81.732,60.049C6.669,116.84,0.515,145.064,0.26,146.251c-0.465,2.169-0.4,4.389,0.965,6.139
                    c1.315,1.686,2.863,2.687,4.959,2.826c1.603,0.688,12.701,6.773,11.941,42.529c-0.771,36.198,4.35,61.241,8.783,75.874
                    c2.443,8.067,8.828,14.072,17.079,16.062c1.866,0.451,3.74,0.671,5.589,0.671c6.169,0,12.063-2.453,16.459-7.009
                    c0.276-0.286,0.537-0.584,0.809-0.873c10.275,48.897,43.07,88.108,73.642,103.725c3.472,7.191,9.048,13.734,16.5,19.199
                    c1.92,1.408,3.944,2.707,6.04,3.92c6.557,18.666,23.614,41.598,52.426,51.809c8.374,13.627,23.416,22.737,40.55,22.737
                    s32.177-9.11,40.551-22.737c28.829-10.21,45.791-32.938,52.429-51.811c2.094-1.212,4.117-2.51,6.036-3.918
                    c7.452-5.465,13.028-12.008,16.5-19.199c30.572-15.617,63.367-54.828,73.642-103.725c0.272,0.289,0.532,0.587,0.808,0.873
                    c4.396,4.556,10.289,7.009,16.459,7.009c1.849,0,3.724-0.22,5.589-0.671c8.251-1.991,14.636-7.996,17.079-16.062
                    c4.431-14.634,9.552-39.676,8.783-75.874c-0.761-35.757,10.338-41.842,11.941-42.529c2.096-0.139,3.644-1.14,4.959-2.826
                    C512.139,150.641,512.205,148.421,511.74,146.251z M55.246,272.931c-2.857,2.959-6.367,2.506-7.742,2.174
                    c-3.026-0.73-5.36-2.91-6.245-5.832c-4.117-13.593-8.871-36.981-8.142-71.209c0.745-35.013-9.327-48.815-16.809-54.227
                    c5.856-21.863,30.908-100.702,87.442-100.702c11.818,0,26.104,4.37,36.828,8.43C100.3,73.678,94.25,122.601,88.377,170.09
                    C83.6,208.722,78.661,248.669,55.246,272.931z M183.516,417.377c6.519,1.556,13.379,2.377,20.398,2.377
                    c1.516,0,3.023-0.052,4.522-0.127v16.669c0,1.804,0.11,3.582,0.307,5.334C197.483,435.185,189.134,426.322,183.516,417.377z
                     M288.569,436.296c0,17.959-14.611,32.569-32.569,32.569c-17.958,0-32.569-14.611-32.569-32.569v-18.707
                    c9.207-2.098,17.74-5.687,25.072-10.6v21.294c0,4.14,3.357,7.497,7.497,7.497s7.497-3.357,7.497-7.497v-21.294
                    c7.331,4.913,15.865,8.502,25.072,10.6V436.296z M303.254,441.65c0.198-1.758,0.31-3.543,0.31-5.353v-16.669
                    c1.499,0.075,3.006,0.127,4.522,0.127c7.028,0,13.897-0.823,20.423-2.384C322.891,426.356,314.55,435.208,303.254,441.65z
                     M478.884,198.064c0.729,34.227-4.026,57.616-8.142,71.209c-0.885,2.922-3.22,5.102-6.245,5.832
                    c-1.377,0.331-4.885,0.785-7.741-2.174c-23.414-24.262-28.354-64.209-33.131-102.841c-3.185-25.755-6.478-52.386-15.297-74.421
                    c-1.538-3.844-5.901-5.713-9.746-4.174c-3.845,1.538-5.713,5.902-4.174,9.746c8.097,20.231,11.128,44.741,14.337,70.689
                    c4.099,33.143,8.317,67.191,23.917,93.747c-3.228,29.998-15.668,53.28-25.644,67.623c-9.161,13.171-20.179,24.504-31.411,32.511
                    c-0.771-13.313-8.008-25.609-20.589-34.835c-12.021-8.816-27.705-13.85-44.399-14.314c-4.77-18.495-27.043-32.098-54.617-32.098
                    s-49.848,13.604-54.617,32.099c-3.566,0.1-7.118,0.4-10.592,0.917c-4.096,0.61-6.921,4.423-6.312,8.519
                    c0.554,3.722,3.754,6.395,7.406,6.395c0.367,0,0.739-0.027,1.113-0.083c2.764-0.412,5.592-0.661,8.435-0.755
                    c4.619,16.7,24.138,25.596,37.62,31.737l0.549,0.25c5.212,2.375,10.805,3.563,16.4,3.563c5.593,0,11.189-1.188,16.399-3.563
                    l0.549-0.25c13.482-6.143,33.002-15.037,37.62-31.739c27.856,0.905,50.12,16.943,50.12,36.532
                    c0,20.168-23.597,36.576-52.602,36.576c-14.559,0-28.133-4.126-38.22-11.619c-8.164-6.064-19.567-6.063-27.731,0
                    c-10.088,7.492-23.661,11.619-38.22,11.619c-29.004,0-52.602-16.408-52.602-36.576c0-8.81,4.679-17.362,13.176-24.08
                    c3.248-2.568,3.799-7.283,1.231-10.531s-7.282-3.798-10.531-1.231c-11.452,9.056-18.057,20.862-18.797,33.466
                    c-11.231-8.007-22.248-19.339-31.408-32.509c-9.975-14.343-22.416-37.625-25.644-67.623c15.6-26.555,19.819-60.603,23.917-93.746
                    c3.264-26.39,6.346-51.316,14.759-71.727c8.704-21.117,21.993-34.063,41.661-40.601c15.973,5.638,26.646,2.767,39.972-0.828
                    c12.599-3.398,28.281-7.627,56.351-7.627s43.751,4.228,56.351,7.627c7.905,2.132,14.874,4.012,22.571,4.012
                    c5.276,0,10.898-0.889,17.393-3.18c10.637,3.533,19.335,8.88,26.477,16.348c2.862,2.992,7.607,3.099,10.6,0.237
                    c2.993-2.862,3.099-7.607,0.237-10.6c-5.301-5.543-11.407-10.224-18.259-14.007c10.729-4.065,25.044-8.45,36.881-8.45
                    c56.435,0,81.559,78.845,87.437,100.706C488.206,149.255,478.139,163.057,478.884,198.064z M296.583,324.112
                    c0,12.036-17.253,19.896-29.851,25.635l-0.551,0.251c-6.47,2.95-13.891,2.95-20.361,0l-0.551-0.251
                    c-12.597-5.739-29.851-13.599-29.851-25.635c0-13.31,18.584-24.555,40.582-24.555
                    C277.998,299.557,296.583,310.802,296.583,324.112z"/>
            </g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        </svg>';
    }

    if ($icon == 'bird') {
        return '<?xml version="1.0" encoding="iso-8859-1"?>
        <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
             viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">
        <g>
            <g>
                <path d="M72.961,95.275c-2.381-1.579-5.41-1.852-8.055-0.717l-59.733,25.6c-3.14,1.34-5.171,4.429-5.171,7.842
                    s2.031,6.502,5.171,7.842l59.733,25.6c1.075,0.461,2.219,0.691,3.362,0.691c1.647,0,3.285-0.478,4.693-1.408
                    c2.398-1.579,3.84-4.258,3.84-7.125v-51.2C76.801,99.533,75.359,96.854,72.961,95.275z M59.735,140.656l-29.534-12.655
                    l29.534-12.663V140.656z"/>
            </g>
        </g>
        <g>
            <g>
                <path d="M204.801,0.001h-42.667c-32.939,0-59.733,26.795-59.733,59.733c0,4.71,3.823,8.533,8.533,8.533h42.667
                    c32.939,0,59.733-26.795,59.733-59.733C213.335,3.824,209.512,0.001,204.801,0.001z M153.601,51.201H120.33
                    c3.959-19.447,21.205-34.133,41.805-34.133h33.271C191.447,36.515,174.209,51.201,153.601,51.201z"/>
            </g>
        </g>
        <g>
            <g>
                <path d="M128.001,93.867c-14.114,0-25.6,11.486-25.6,25.6s11.486,25.6,25.6,25.6s25.6-11.486,25.6-25.6
                    S142.116,93.867,128.001,93.867z M128.001,128.001c-4.702,0-8.533-3.831-8.533-8.533s3.831-8.533,8.533-8.533
                    c4.702,0,8.533,3.831,8.533,8.533S132.703,128.001,128.001,128.001z"/>
            </g>
        </g>
        <g>
            <g>
                <rect x="221.868" y="435.201" width="17.067" height="68.267"/>
            </g>
        </g>
        <g>
            <g>
                <rect x="187.735" y="494.934" width="136.533" height="17.067"/>
            </g>
        </g>
        <g>
            <g>
                <rect x="273.068" y="435.201" width="17.067" height="68.267"/>
            </g>
        </g>
        <g>
            <g>
                <rect x="230.401" y="460.801" width="25.6" height="17.067"/>
            </g>
        </g>
        <g>
            <g>
                <rect x="281.601" y="460.801" width="25.6" height="17.067"/>
            </g>
        </g>
        <g>
            <g>
                <path d="M72.552,146.219c-2.628-1.527-5.879-1.536-8.525-0.017l-44.74,25.609c-11.708,6.758-19.098,19.354-19.285,32.99v3.942
                    C-0.084,219,3.824,228.668,11.018,235.99c7.194,7.313,16.802,11.392,27.127,11.477h0.256c21.18,0,38.4-17.22,38.4-38.4v-55.467
                    C76.801,150.563,75.18,147.747,72.552,146.219z M59.735,209.067c0,11.768-9.566,21.333-21.333,21.333v8.533l-0.179-8.533
                    c-5.7-0.051-11.034-2.313-15.036-6.374c-3.994-4.062-6.17-9.438-6.118-15.206v-3.9c0.102-7.535,4.224-14.558,10.726-18.313
                    l31.94-18.287V209.067z"/>
            </g>
        </g>
        <g>
            <g>
                <path d="M512.001,59.734v-8.533h-76.8c-0.009,0-0.009,0-0.026,0c-60.279,0-115.994,35.174-141.901,89.6l-37.274,78.285
                    L196.447,94.089c-10.991-24.183-34.253-40.602-60.911-42.871c-19.072-1.212-37.367,5.094-51.652,17.698
                    C69.599,81.528,61.074,98.945,59.88,117.94c-0.102,1.527-0.145,3.063-0.145,4.599v129.203c0.06,105.805,86.178,191.94,192,191.991
                    c102.844,0,186.325-91.665,191.727-171.11c38.477-4.13,68.54-36.796,68.54-76.356v-8.533h-28.578
                    c17.417-14.089,28.578-35.635,28.578-59.733v-8.533h-28.578C500.84,105.379,512.001,83.832,512.001,59.734z M494.329,136.534
                    c-4.156,28.911-29.082,51.2-59.128,51.2v17.067h59.128c-4.156,28.911-29.082,51.2-59.128,51.2h-8.533v8.533
                    c0,72.986-80.725,162.133-174.933,162.133c-96.41-0.051-174.891-78.524-174.933-174.933V122.539c0-1.169,0.034-2.33,0.111-3.516
                    c0.905-14.473,7.39-27.716,18.261-37.308c10.018-8.832,22.639-13.585,35.729-13.585c1.118,0,2.244,0.034,3.379,0.102
                    c20.318,1.732,38.187,14.345,46.694,33.058l75.034,157.483l52.676-110.635c23.1-48.521,72.747-79.872,126.49-79.872
                    c0.009,0,0.017,0,0.026,0h59.128c-4.156,28.911-29.082,51.2-59.128,51.2v17.067H494.329z"/>
            </g>
        </g>
        <g>
            <g>
                <path d="M281.601,256.001v17.067h100.284c-7.868,24.883-31.283,42.633-58.061,42.667l-0.162,17.067c0.06,0,0.111,0,0.179,0h23.91
                    c-7.868,24.909-31.326,42.667-58.138,42.667c-0.026,0-0.051,0-0.077,0h-33.536c-61.167,0-110.933-49.766-110.933-110.933v-8.533
                    h-17.067v8.533c0,70.579,57.421,128,128,128h33.527c0.034,0,0.06,0,0.094,0c38.622,0,71.825-28.826,77.227-67.072l0.896-6.374
                    c17.545-12.058,30.089-31.112,33.237-53.359l1.374-9.728H281.601z"/>
            </g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        <g>
        </g>
        </svg>';
    }
}
